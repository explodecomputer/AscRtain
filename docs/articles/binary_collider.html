<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collider bias for binary variables • AscRtain</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Collider bias for binary variables">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AscRtain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/binary_collider.html">Collider bias for binary variables</a>
    </li>
    <li>
      <a href="../articles/collider_ascertainment.html">Ascertainment on a collider</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/explodecomputer/AscRtain">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Collider bias for binary variables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/explodecomputer/AscRtain/blob/master/vignettes/binary_collider.Rmd"><code>vignettes/binary_collider.Rmd</code></a></small>
      <div class="hidden name"><code>binary_collider.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(AscRtain)</span></code></pre></div>
<p>Following <a href="https://osf.io/vrcuf/" class="uri">https://osf.io/vrcuf/</a>, can infer the biased OR for a binary exposure (<span class="math inline">\(A\)</span>) on a binary outcome (<span class="math inline">\(Y\)</span>) when both of the traits influence the probability of being present in the sample (<span class="math inline">\(S\)</span>)</p>
<p>Assume that being present in the sample is simply:</p>
<p><span class="math display">\[
P(S = 1 | A,Y) = \beta_0 + \beta_A A + \beta_Y Y + \beta_{AY} AY
\]</span></p>
<p>where <span class="math inline">\(A = {0,1}\)</span> and <span class="math inline">\(Y = {0,1}\)</span>. The expected odds ratio under this scenario is then:</p>
<p><span class="math display">\[
E[\hat{OR}_{S=1}] = \frac{\beta_0(\beta_0 + \beta_A + \beta_Y + \beta_{AY})}{(\beta_0 + \beta_A)(\beta_0 + \beta_Y)}
\]</span></p>
<p>Suppose that we know the fraction of the population that is present in our sample (<span class="math inline">\(p_{S}\)</span>). We are only interested in the <span class="math inline">\(\beta_*\)</span> parameter values that give rise to a value of <span class="math inline">\(p_{S}\)</span> that is within the bounds of expectation:</p>
<p><span class="math display">\[
p_{S} = \beta_0 + \beta_A p_A + \beta_Y p_Y + \beta_{AY} p_{AY}
\]</span></p>
<p>Scenario: we find an association between <span class="math inline">\(A\)</span> and <span class="math inline">\(Y\)</span> in our ascertained sample. Our question is what effects must <span class="math inline">\(A\)</span> and <span class="math inline">\(Y\)</span> have on sample ascertainment in order to induce the observed odds ratio <span class="math inline">\(OR\)</span>, assuming that the true odds ratio is 1.</p>
<p>Initialise a new <code>VBB</code> (<strong>V</strong>-structure, <strong>B</strong>inary exposure, <strong>B</strong>inary outcome) class</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>x &lt;-<span class="st"> </span>VBB<span class="op">$</span><span class="kw">new</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>x</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; &lt;VBB&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;   Public:</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;     clone: function (deep = FALSE) </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;     histogram: function (bins = 30) </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;     or_calc: function (b0, ba, by, bay) </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;     param: NULL</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;     parameter_space: function (target_or, pS, pA, pY, pAY, b0_range, ba_range, by_range, </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;     ps_calc: function (b0, ba, by, bay, pA, pY, pAY) </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt;     scatter: function () </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;     scatter3d: function (ticktype = "detailed", theta = 130, phi = 0, bty = "g",</span></span></code></pre></div>
<p>Example of how to calculate the odds ratio for given <span class="math inline">\(\beta_*\)</span> parameters:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>x<span class="op">$</span><span class="kw">or_calc</span>(<span class="dt">b0=</span><span class="fl">0.1</span>, <span class="dt">ba=</span><span class="fl">0.2</span>, <span class="dt">by=</span><span class="fl">0.3</span>, <span class="dt">bay=</span><span class="fl">0.4</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#&gt; [1] 0.8333333</span></span></code></pre></div>
<p>Search over a parameter space of possible values to identify whether some target odds ratio could be explained by sample ascertainment</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>x<span class="op">$</span><span class="kw">parameter_space</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="dt">target_or=</span><span class="dv">2</span>, </span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="dt">pS=</span><span class="fl">0.0275</span>, </span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="dt">pA=</span><span class="fl">0.15</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="dt">pY=</span><span class="fl">0.1</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="dt">pAY=</span><span class="dv">0</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="dt">b0_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="fl">0.1</span>), </span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="dt">ba_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.2</span>,<span class="fl">0.2</span>), </span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="dt">by_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.2</span>,<span class="fl">0.2</span>), </span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="dt">bay_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>), </span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="dt">granularity=</span><span class="dv">200</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>)</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; 8000000 parameter combinations</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; 351734 within pS_tol</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; 30893 beyond OR threshold</span></span></code></pre></div>
<p>The parameter values that meet the target OR due to collider bias</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>x<span class="op">$</span>param</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt; # A tibble: 30,893 x 9</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt;       pA    pY   pAY     b0      ba    by   bay    ps1    or</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt;  1  0.15   0.1     0 0.0573 -0.0553  -0.2     0 0.0290  39.5</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;  2  0.15   0.1     0 0.0578 -0.0553  -0.2     0 0.0295  31.9</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt;  3  0.15   0.1     0 0.0548 -0.0533  -0.2     0 0.0268  49.7</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt;  4  0.15   0.1     0 0.0553 -0.0533  -0.2     0 0.0273  37.6</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt;  5  0.15   0.1     0 0.0558 -0.0533  -0.2     0 0.0278  30.4</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt;  6  0.15   0.1     0 0.0563 -0.0533  -0.2     0 0.0283  25.6</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt;  7  0.15   0.1     0 0.0568 -0.0533  -0.2     0 0.0288  22.1</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt;  8  0.15   0.1     0 0.0573 -0.0533  -0.2     0 0.0293  19.6</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt;  9  0.15   0.1     0 0.0578 -0.0533  -0.2     0 0.0298  17.6</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; 10  0.15   0.1     0 0.0528 -0.0513  -0.2     0 0.0251  47.2</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; # … with 30,883 more rows</span></span></code></pre></div>
<p>Visualise the distribution of odds ratios found across the range of parameters</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>x<span class="op">$</span><span class="kw">histogram</span>()</span></code></pre></div>
<p><img src="binary_collider_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Visualise the <span class="math inline">\(\beta_*\)</span> parameter ranges that meet the target odds ratio</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>x<span class="op">$</span><span class="kw">scatter</span>()</span></code></pre></div>
<p><img src="binary_collider_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Or in 3D:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>x<span class="op">$</span><span class="kw">scatter3d</span>()</span></code></pre></div>
<p><img src="binary_collider_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Can try to do this in 3D also:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>plot3Drgl<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/plot3Drgl/man/plotrgl.html">plotrgl</a></span>()</span></code></pre></div>
<div id="check-the-results-through-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#check-the-results-through-simulation" class="anchor"></a>Check the results through simulation</h2>
<p>Here, <span class="math inline">\(A\)</span> is ACE inhibitor use, <span class="math inline">\(Y\)</span> is Covid-19 status, and <span class="math inline">\(S\)</span> is presence in the first release of the COVID Symptom Tracker dataset.</p>
<p>Observational association of ACE-i influence on Covid-19 status gives OR <span class="math inline">\(\approx 2\)</span>. Assume 7.8% of population take ACE-i, 10% are infected with coronavirus at the time of sampling, 1.9 million of an adult population of 54 million are present in the sample (3.5%). What influences of ACE-inhibitor use and Covid-19 status would be required to induce a collider bias of <span class="math inline">\(OR=2\)</span>?</p>
<p>Enter parameters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>x &lt;-<span class="st"> </span>VBB<span class="op">$</span><span class="kw">new</span>()</span>
<span id="cb10-2"><a href="#cb10-2"></a>x<span class="op">$</span><span class="kw">parameter_space</span>(  </span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="dt">target_or=</span><span class="fl">2.07</span>, </span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="dt">pS=</span><span class="fl">0.035</span>, </span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="dt">pA=</span><span class="fl">0.078</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="dt">pY=</span><span class="fl">0.1</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="dt">pAY=</span><span class="dv">0</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="dt">b0_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="fl">0.1</span>), </span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="dt">ba_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>), </span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="dt">by_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>), </span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="dt">bay_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>), </span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="dt">granularity=</span><span class="dv">200</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>)</span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt; 8000000 parameter combinations</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; 397920 within pS_tol</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; 56714 beyond OR threshold</span></span></code></pre></div>
<p>Within our sample the prevalence of ACEi use is 4.2%. In the general population it is 7.8%. This means we can narrow down the range of our simulations to only look at parameter values that would give that level of selection (reduced likelihood of selection when on ACEi).</p>
<p>Need to figure out what value of <span class="math inline">\(\beta_A\)</span> could give rise to the difference in prevalences between population and sample/</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>n &lt;-<span class="st"> </span><span class="dv">1000000</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>Y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(n, <span class="dv">1</span>, <span class="fl">0.1</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a>A &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(n, <span class="dv">1</span>, <span class="fl">0.078</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>pS &lt;-<span class="st"> </span><span class="fl">0.03</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.02</span> <span class="op">*</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">*</span><span class="st"> </span>Y</span>
<span id="cb11-5"><a href="#cb11-5"></a>S &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(n, <span class="dv">1</span>, pS)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># target 4.2% in sample</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># assume 7.8% in uk</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>dat &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(A,Y,S)</span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(dat, S<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>{<span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(.<span class="op">$</span>A)<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(.<span class="op">$</span>S)}</span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt;          0          1 </span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; 0.95978657 0.04021343</span></span></code></pre></div>
<p>Likely somewhere between <span class="math inline">\(-0.1\)</span> and <span class="math inline">\(-0.2\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>x<span class="op">$</span><span class="kw">scatter</span>() <span class="op">+</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x=</span><span class="st">"Effect of ACE-i on inclusion probability (bA)"</span>, <span class="dt">y=</span><span class="st">"Effect of Covid-19 on inclusion probability (bY)"</span>, <span class="dt">colour=</span><span class="st">"Baseline inclusion</span><span class="ch">\n</span><span class="st">probability (b0)"</span>) <span class="op">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="st">"rect"</span>, <span class="dt">xmin=</span><span class="op">-</span><span class="fl">0.01</span>, <span class="dt">xmax=</span><span class="op">-</span><span class="fl">0.02</span>, <span class="dt">ymin=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax=</span><span class="ot">Inf</span>, <span class="dt">alpha=</span><span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="binary_collider_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>We can also ask - is our association actually more likely to be attenuated to OR=2, rather than inflated from OR=1. Let’s search the parameter space for parameter sets that give OR=0.8 and superimpose on the figure.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>x1 &lt;-<span class="st"> </span>VBB<span class="op">$</span><span class="kw">new</span>()</span>
<span id="cb13-2"><a href="#cb13-2"></a>x1<span class="op">$</span><span class="kw">parameter_space</span>( </span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="dt">target_or=</span><span class="fl">0.8</span>, </span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="dt">pS=</span><span class="fl">0.035</span>, </span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="dt">pA=</span><span class="fl">0.078</span>,</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="dt">pY=</span><span class="fl">0.1</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="dt">pAY=</span><span class="dv">0</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="dt">b0_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="fl">0.1</span>), </span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="dt">ba_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>), </span>
<span id="cb13-10"><a href="#cb13-10"></a>    <span class="dt">by_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>), </span>
<span id="cb13-11"><a href="#cb13-11"></a>    <span class="dt">bay_range=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>), </span>
<span id="cb13-12"><a href="#cb13-12"></a>    <span class="dt">granularity=</span><span class="dv">200</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>)</span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt; 8000000 parameter combinations</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt; 397920 within pS_tol</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt; 111625 beyond OR threshold</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>x<span class="op">$</span><span class="kw">scatter</span>() <span class="op">+</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x=</span><span class="st">"Effect of ACE-i on inclusion probability (bA)"</span>, <span class="dt">y=</span><span class="st">"Effect of Covid-19 on inclusion probability (bY)"</span>, <span class="dt">colour=</span><span class="st">"Baseline inclusion</span><span class="ch">\n</span><span class="st">probability (b0)"</span>) <span class="op">+</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="st">"rect"</span>, <span class="dt">xmin=</span><span class="op">-</span><span class="fl">0.01</span>, <span class="dt">xmax=</span><span class="op">-</span><span class="fl">0.02</span>, <span class="dt">ymin=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax=</span><span class="ot">Inf</span>, <span class="dt">alpha=</span><span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">data=</span>x1<span class="op">$</span>param, <span class="dt">colour=</span><span class="st">"red"</span>, <span class="dt">size=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="binary_collider_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>So it could go either way really, a lot of the figure is shaded in both blue and red, and we don’t know what the actual selection based on covid is. This indicates that it is really not reliable to be making claims about causality from this type of sampling.</p>
<p>Note that some areas of the figure have both negative and positive bias - that is because it changes with different levels of background participation (<span class="math inline">\(\beta_0\)</span>). This parameter is particularly difficult to estimate what the likely true value is.</p>
</div>
<div id="simulate-to-check" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-to-check" class="anchor"></a>Simulate to check</h2>
<p>Simulate individual level data according to the first result, where <span class="math inline">\(A\)</span> has no influence on <span class="math inline">\(Y\)</span>. Note that using a population size of 1 million as the sample size doesn’t matter, just the proportion sampled.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>a &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(x<span class="op">$</span>param, by <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>ba <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">&amp;</span><span class="st"> </span>b0 <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.02</span>)[<span class="dv">1</span>,]</span>
<span id="cb14-2"><a href="#cb14-2"></a>n &lt;-<span class="st"> </span><span class="dv">1000000</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>Y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(n, <span class="dv">1</span>, a<span class="op">$</span>pY)</span>
<span id="cb14-4"><a href="#cb14-4"></a>A &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(n, <span class="dv">1</span>, a<span class="op">$</span>pA)</span>
<span id="cb14-5"><a href="#cb14-5"></a>pS &lt;-<span class="st"> </span>a<span class="op">$</span>b0 <span class="op">+</span><span class="st"> </span>a<span class="op">$</span>ba <span class="op">*</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>a<span class="op">$</span>by <span class="op">*</span><span class="st"> </span>Y</span>
<span id="cb14-6"><a href="#cb14-6"></a>S &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(n, <span class="dv">1</span>, pS)</span></code></pre></div>
<p>What proportion of the population are present in the sample?</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(S) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(S)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt; [1] 0.036631</span></span></code></pre></div>
<p>Estimate association between <code>A</code> and <code>Y</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(Y[<span class="kw"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(S)] <span class="op">~</span><span class="st"> </span>A[<span class="kw"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span>(S)], <span class="dt">family=</span><span class="st">"binomial"</span>))<span class="op">$</span>coef[<span class="dv">2</span>,<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span>exp</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt; [1] 20.76675</span></span></code></pre></div>
<p>Compare to expected biased association</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>a<span class="op">$</span>or</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co">#&gt; [1] 17.42574</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#check-the-results-through-simulation">Check the results through simulation</a></li>
      <li><a href="#simulate-to-check">Simulate to check</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gibran Hemani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
