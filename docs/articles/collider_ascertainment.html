<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ascertainment on a collider • AscRtain</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ascertainment on a collider">
<meta property="og:description" content="AscRtain">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AscRtain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/binary_collider.html">Collider bias for binary variables</a>
    </li>
    <li>
      <a href="../articles/collider_ascertainment.html">Ascertainment on a collider</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/explodecomputer/AscRtain/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ascertainment on a collider</h1>
                        <h4 class="author">Gibran Hemani</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/explodecomputer/AscRtain/blob/master/vignettes/collider_ascertainment.rmd"><code>vignettes/collider_ascertainment.rmd</code></a></small>
      <div class="hidden name"><code>collider_ascertainment.rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>({
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pwr</span>)
}))
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span>$<span class="fu">set</span>(<span class="kw">echo</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">message</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">warning</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">dev</span><span class="kw">=</span><span class="st">"png"</span>)</pre></body></html></div>
<p><span class="math inline">\(\newcommand{\var}[1]{\operatorname{var}\left(#1\right)} \newcommand{\E}[1]{\mathbb{E}\left[#1\right]} \newcommand{\logit}[1]{\operatorname{logit}\left(#1\right)} \DeclareMathOperator{\cov}{cov}\)</span></p>
<p>The purpose of expanding sample sizes for genome-wide association studies, now happening at a rapid rate with the advent of population scale biobanks, is to detect more and more genetic variants associated with complex traits of interest. With 5 million samples, the effect sizes detectable are extremely small. While this provides exquisite power to detect extremely small effects, it opens up new avenues of subtle bias. One such problem arises because the recruited individuals are not representative of the general population. If they are ascertained, for example for higher education levels, collider bias will induce correlations amongst all the causes of higher education levels within the sample. This problem is typically ignored because the magnitude of the collider bias is relatively small, and unlikely to be detectable at genome-wide significance thresholds. However, with extreme statistical power that safety may disappear.</p>
<p>The UK has a population of 50 million adults. In the next major genotyping effort, 5 million will be sampled and genotyped. In principle this is to improve statistical power for GWAS. In many cases the GWAS signals of interest are only those that are very strongly associated, e.g. with <span class="math inline">\(p &lt; 5\times10^{-8}\)</span>. This likely guards against a lot of the potential problems that can arise due to subtle sampling issues such as collider bias in ascertained samples.</p>
<p><strong>Question:</strong> When power to detect very small effects gets large, is the problem of collider bias arising due to ascertainment in GWAS now a realistic problem?</p>
<p><strong>Question:</strong> As more of the population is sampled, how does this bias change in power and magnitude?</p>
<p>Use educational attainment (<span class="math inline">\(S\)</span>) as the variable that influences ascertainment, and ascertainment is a binary variable <span class="math inline">\(z\)</span> which indicates if the individual is in the sample. Suppose that educational attainment influences the probability of being recruited into the sample, or at least having non-missing data in the sample. The logistic function can be used to model the relationship of influence of educational attainment on being sampled</p>
<p><span class="math display">\[
\logit{\mu_i} = \alpha + \delta S_i
\]</span></p>
<p>where <span class="math inline">\(\mu_i\)</span> is the probability for the <span class="math inline">\(i\)</span>th individual being included in the sample based on their value of <span class="math inline">\(S\)</span>, and the intercept <span class="math inline">\(\alpha\)</span> indicates the proportion of individuals in the population who are sampled, <span class="math inline">\(p\)</span> by:</p>
<p><span class="math display">\[
p = \frac{1}{1 + \exp{-\alpha}}
\]</span></p>
<p>The (biased) estimate of the effect of a genetic variant (<span class="math inline">\(G\)</span>) on some predictor of education (<span class="math inline">\(X\)</span>), when estimated only amongst recruited samples (<span class="math inline">\(Z = 1\)</span>), is given by</p>
<p><span class="math display">\[
\widehat{\beta}_{GX} = \frac{\sigma_{GX}/\sigma_{G} - \sigma_{GZ}\sigma_{XZ} / \sigma_{Z}^2}{1 - (\sigma_{GZ}/\sigma_{Z})^2}
\]</span></p>
<p>Given the relationship between education and recruitment, we can parameterise the bias in terms of:</p>
<ul>
<li>
<span class="math inline">\(p\)</span> - proportion of the sample recruited,</li>
<li>
<span class="math inline">\(\delta\)</span> - how strongly education influences recruitment,</li>
<li>
<span class="math inline">\(\beta_{GS}\)</span> - the effect of a genetic variant on education,</li>
<li>
<span class="math inline">\(\beta_{XS}\)</span> - the effect of a factor for education on education,</li>
<li>
<span class="math inline">\(m\)</span> - allele frequency of the genetic variant</li>
<li>
<span class="math inline">\(\sigma^2_{G} = 2m(1-m)\)</span>,</li>
<li>
<span class="math inline">\(\sigma^2_{X}\)</span> - the variance of the factor for education,</li>
<li>
<span class="math inline">\(\sigma^2_{S}\)</span> - the variance of educational attainment</li>
</ul>
<p>The value of <span class="math inline">\(Z\)</span> indicates if an individual is present in the sample, and this is a function of</p>
<p><span class="math display">\[
\sigma_{GZ} = \cov\left(G,\frac{p}{1-p}\delta S\right)
\]</span></p>
<p><span class="math display">\[
\widehat{\beta}_{GX} = \frac{\sigma_{GX}/2m(1-m) - \cov(G, \frac{p}{1-p}\delta S)\cov(X, \frac{p}{1-p}\delta S) / \sigma_{Z}^2}{1 - \left(\cov(G, \frac{p}{1-p}\delta S)/\sigma_{Z}\right)^2}
\]</span></p>
<p>There are two different methods for estimating the collider effect.</p>
<p>Groenwold, Palmer and Tilling (2020, <a href="https://osf.io/vrcuf/" class="uri">https://osf.io/vrcuf/</a>) gives:</p>
<p><span class="math display">\[
\widehat{\beta}_{xy|s} = \frac{\beta_{xy} \sigma^2_{s} \sigma^2_{x} - \beta_{xs} \beta_{ys} \sigma^2_x \sigma^2_y}{\beta^2_{ys} \sigma^2_x \sigma^2_y + \sigma^2_s \sigma^2_x}
\]</span></p>
<p>Pearl (2013, <a href="https://ftp.cs.ucla.edu/pub/stat_ser/r409_submitted_corrected.pdf" class="uri">https://ftp.cs.ucla.edu/pub/stat_ser/r409_submitted_corrected.pdf</a>) gives:</p>
<p><span class="math display">\[
\widehat{\beta}_{xy|s} = \frac{\sigma_{xy} - \sigma_{sy} \sigma_{sx}}{1 - \sigma^2_{sx}}
\]</span></p>
<p>This assumes error terms are equal I think.</p>
<p>I get differing results between these solutions when the variances of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> change. An alternative to the first one is:</p>
<p><span class="math display">\[
\widehat{\beta}_{xy|s} = \frac{\beta_{xy} \sigma^2_{s} \sigma^2_{x} - \beta_{xs} \beta_{ys} \sigma^2_x \sigma^2_y}{\beta^2_{ys} \sigma^2_x \sigma^2_y + \sigma^2_x}
\]</span></p>
<p>Simulate continuous collider that influences a continuous conditioning variable</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">20200420</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">100000</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">b_xy</span> <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="no">b_xs</span> <span class="kw">&lt;-</span> <span class="fl">6</span>
<span class="no">b_ys</span> <span class="kw">&lt;-</span> <span class="fl">8</span>
<span class="no">b_sz</span> <span class="kw">&lt;-</span> <span class="fl">5</span>
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="no">b_xs</span> + <span class="no">y</span> * <span class="no">b_ys</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="no">s</span> * <span class="no">b_sz</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)</pre></body></html></div>
<p>Bias in x-y assoc when conditioning on s</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xs</span> * <span class="no">b_ys</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_ys</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
<span class="co">#&gt; [1] -0.7384592</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">s</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.7379023</span></pre></body></html></div>
<p>Bias in x-y assoc when conditioning on z</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">b_xz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">x</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="no">b_yz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">y</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.7497879</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">z</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.7374491</span></pre></body></html></div>
<p>Is the same.. why?</p>
<p>Now make x binary. This also changes its mean and variance. Change y variance also</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">12345</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">100000</span>
<span class="no">maf</span> <span class="kw">&lt;-</span> <span class="fl">0.3</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">2</span>, <span class="no">maf</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span><span class="kw">=</span><span class="fl">3</span>)
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="fl">6</span> + <span class="no">y</span> * <span class="fl">8</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="no">s</span> * <span class="fl">5</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)</pre></body></html></div>
<p>Bias in x-y assoc when conditioning on s</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xs</span> * <span class="no">b_ys</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_ys</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
<span class="co">#&gt; [1] -0.7487032</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">s</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.7491357</span></pre></body></html></div>
<p>Bias in x-y assoc when conditioning on z</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">b_xz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">x</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="no">b_yz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">y</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.7601216</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">z</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.7491772</span></pre></body></html></div>
<p>Now make z binary</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">2</span>, <span class="no">maf</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="no">b_xs</span> + <span class="no">y</span> * <span class="no">b_ys</span>
<span class="no">l</span> <span class="kw">&lt;-</span> <span class="no">b_sz</span>*<span class="no">s</span>
<span class="no">pr</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">l</span>))
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">1</span>, <span class="no">pr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">z</span>)
<span class="co">#&gt; z</span>
<span class="co">#&gt;     0     1 </span>
<span class="co">#&gt; 34984 65016</span></pre></body></html></div>
<p>Condition on z</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">b_xz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">x</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="no">b_yz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">y</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.2399797</span>
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
<span class="co">#&gt;           x </span>
<span class="co">#&gt; -0.07334314</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">z</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.3886506</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>] ~ <span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>])$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;  x[z == 1] </span>
<span class="co">#&gt; -0.3450915</span></pre></body></html></div>
<p>Now it’s weird because it seems to need the var(z) term in the denominator.. compare different methods:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="no">param</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(
    <span class="kw">n</span> <span class="kw">=</span> <span class="fl">100000</span>,
    <span class="kw">maf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>),
    <span class="kw">b_xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.3</span>),
    <span class="kw">b_xs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>),
    <span class="kw">b_ys</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.4</span>, <span class="fl">0.8</span>),
    <span class="kw">b_sz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.4</span>, <span class="fl">0.8</span>),
    <span class="kw">sdy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>),
    <span class="kw">alpha</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>),
    <span class="kw">sim</span><span class="kw">=</span><span class="fl">1</span>
)

<span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">param</span>))
{
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="no">i</span>)
    <span class="no">pa</span> <span class="kw">&lt;-</span> <span class="no">param</span>[<span class="no">i</span>, ]
    <span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">pa</span>$<span class="no">n</span>, <span class="fl">2</span>, <span class="no">pa</span>$<span class="no">maf</span>)
    <span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">pa</span>$<span class="no">n</span>, <span class="kw">sd</span><span class="kw">=</span><span class="no">pa</span>$<span class="no">sdy</span>)
    <span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="no">pa</span>$<span class="no">b_xs</span> + <span class="no">y</span> * <span class="no">pa</span>$<span class="no">b_ys</span>
    <span class="no">l</span> <span class="kw">&lt;-</span> <span class="no">pa</span>$<span class="no">alpha</span> + <span class="no">pa</span>$<span class="no">b_sz</span>*<span class="no">s</span>
    <span class="no">pr</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">l</span>))
    <span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">pa</span>$<span class="no">n</span>, <span class="fl">1</span>, <span class="no">pr</span>)
    <span class="no">b_xz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">z</span>) / <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)
    <span class="no">b_yz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">z</span>) / <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)
    <span class="no">pa</span>$<span class="no">est1</span> <span class="kw">&lt;-</span> (<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
    <span class="no">pa</span>$<span class="no">est2</span> <span class="kw">&lt;-</span> (<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
    <span class="no">pa</span>$<span class="no">est3</span> <span class="kw">&lt;-</span> (<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">y</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">x</span>) - <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>, <span class="no">z</span>) / <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>)) / (<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">z</span>)^<span class="fl">2</span>/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
    <span class="no">pa</span>$<span class="no">est4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">z</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
    <span class="no">pa</span>$<span class="no">est5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>], <span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>]) / <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>])
    <span class="no">out</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="no">pa</span>
}

<span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/bind.html">bind_rows</a></span>(<span class="no">out</span>)
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">out</span>, <span class="kw">select</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">est1</span>, <span class="no">est2</span>, <span class="no">est3</span>, <span class="no">est4</span>, <span class="no">est5</span>)) <span class="kw">%&gt;%</span> <span class="no">pairs</span></pre></body></html></div>
<p><img src="collider_ascertainment_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">out</span>, <span class="kw">select</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">est1</span>, <span class="no">est2</span>, <span class="no">est3</span>, <span class="no">est4</span>, <span class="no">est5</span>)) <span class="kw">%&gt;%</span> <span class="no">cor</span>
<span class="co">#&gt;           est1      est2      est3      est4      est5</span>
<span class="co">#&gt; est1 1.0000000 0.9629110 0.8738554 0.9780196 0.9710900</span>
<span class="co">#&gt; est2 0.9629110 1.0000000 0.8355253 0.9546122 0.9537294</span>
<span class="co">#&gt; est3 0.8738554 0.8355253 1.0000000 0.9066688 0.8934389</span>
<span class="co">#&gt; est4 0.9780196 0.9546122 0.9066688 1.0000000 0.9920717</span>
<span class="co">#&gt; est5 0.9710900 0.9537294 0.8934389 0.9920717 1.0000000</span></pre></body></html></div>
<p>Ok just use the original version in Groenwold 2020, it has the best correlation across parameters with the actual conditioning method.</p>
<div id="substituting-in-simulation-terms" class="section level2">
<h2 class="hasAnchor">
<a href="#substituting-in-simulation-terms" class="anchor"></a>Substituting in simulation terms</h2>
<p>Can we present in terms of <span class="math inline">\(s\)</span> instead of <span class="math inline">\(z\)</span>? What is cov(x,z) in terms of cov(x,s)</p>
<p><span class="math display">\[
\cov(X,Z) = \cov(X,\beta S)
\]</span></p>
<p><span class="math display">\[
\beta = \frac{\cov(S,Z)}{\var{S}}
\]</span></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">2</span>, <span class="no">maf</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="no">b_xs</span> + <span class="no">y</span> * <span class="no">b_ys</span>
<span class="no">l</span> <span class="kw">&lt;-</span> <span class="no">b_sz</span>*<span class="no">s</span>
<span class="no">pr</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">l</span>))
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">1</span>, <span class="no">pr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">z</span>)
<span class="co">#&gt; z</span>
<span class="co">#&gt;     0     1 </span>
<span class="co">#&gt; 34429 65571</span>
<span class="no">b_xz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">x</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="no">b_yz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">y</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.2348822</span>
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>))
<span class="co">#&gt;           x </span>
<span class="co">#&gt; -0.07113873</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x</span> + <span class="no">z</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.3922177</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>] ~ <span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>])$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;  x[z == 1] </span>
<span class="co">#&gt; -0.3489736</span></pre></body></html></div>
<p>Obtain <span class="math inline">\(\beta_{yz}\)</span> in terms of <span class="math inline">\(\beta_{ys}\)</span> and <span class="math inline">\(\beta_{sz}\)</span></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">b_xs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">s</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)
<span class="no">b_ys</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">s</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)
<span class="no">b_sz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">s</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>)
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt;          x </span>
<span class="co">#&gt; -0.2348822</span>
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xs</span> * <span class="no">b_sz</span> * <span class="no">b_ys</span> * <span class="no">b_sz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / ((<span class="no">b_ys</span> * <span class="no">b_sz</span>)^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt; [1] -0.2434724</span></pre></body></html></div>
<p>Present b_sz in terms of OR in logistic regression model</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">2</span>, <span class="no">maf</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="no">b_xs</span> + <span class="no">y</span> * <span class="no">b_ys</span>
<span class="no">l</span> <span class="kw">&lt;-</span> <span class="no">b_sz</span>*<span class="no">s</span>
<span class="no">pr</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">l</span>))
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">1</span>, <span class="no">pr</span>)
<span class="no">b_xz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">x</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="no">b_yz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">y</span>)$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="no">logor</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">z</span> ~ <span class="no">s</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"binomial"</span>)$<span class="no">coef</span>[<span class="fl">2</span>]

<span class="co"># estimate lm</span>
<span class="no">bhat_sz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">z</span> ~ <span class="no">s</span>)$<span class="no">coef</span>[<span class="fl">2</span>]

<span class="co"># convert beta to logor</span>
<span class="no">prop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">z</span> <span class="kw">==</span> <span class="fl">1</span>) / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">z</span>)
<span class="no">mu</span> <span class="kw">&lt;-</span> <span class="no">prop</span> * (<span class="fl">1</span> - <span class="no">prop</span>)

<span class="co"># get beta from logOR</span>
<span class="no">logor</span> * <span class="no">mu</span>
<span class="co">#&gt;          s </span>
<span class="co">#&gt; 0.01054151</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">s</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>)
<span class="co">#&gt; [1] 0.01018716</span>

<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>] ~ <span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>])$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;   x[z == 1] </span>
<span class="co">#&gt; -0.02452379</span>
<span class="no">b_xs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">s</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)
<span class="no">b_ys</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">s</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)
<span class="no">b_sz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">s</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>)

(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xz</span> * <span class="no">b_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">b_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt;           x </span>
<span class="co">#&gt; -0.01945076</span>
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xs</span> * <span class="no">b_sz</span> * <span class="no">b_ys</span> * <span class="no">b_sz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / ((<span class="no">b_ys</span> * <span class="no">b_sz</span>)^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt; [1] -0.01963616</span>
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">b_xs</span> * <span class="no">logor</span> * <span class="no">mu</span> * <span class="no">b_ys</span> * <span class="no">logor</span> * <span class="no">mu</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / ((<span class="no">b_ys</span> * <span class="no">logor</span> * <span class="no">mu</span>)^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt;           s </span>
<span class="co">#&gt; -0.02098708</span></pre></body></html></div>
<p>Quick recap:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{\beta}_{xy|s} &amp;= \frac{\beta_{xy} \sigma^2_{s} \sigma^2_{x} - \beta_{xs} \beta_{ys} \sigma^2_x \sigma^2_y}{\beta^2_{ys} \sigma^2_x \sigma^2_y + \sigma^2_s \sigma^2_x} \\
\widehat{\beta}_{xy|z} &amp;= \frac{\beta_{xy} \sigma^2_{s} 2m(1-m) - \beta_{xs} \beta_{ys} \log{\text{OR}_{sz}}^2 p^2(1-p)^2 2m(1-m) \sigma^2_y}{\beta^2_{ys}\log{\text{OR}_{SZ}} 2m(1-m) \sigma^2_y + \sigma^2_s 2m(1-m)} \\
\end{aligned}
\]</span></p>
<p>So now we need to present betas in terms of variances. What explains <span class="math inline">\(S\)</span>?</p>
<p><span class="math display">\[
\begin{aligned}
S_i &amp;= \beta_{SX} X_i + \beta_{SY} Y_i + e_i \\
R^2_{S} &amp;= \frac{2 \beta^2_{SX} m(1-m) + \beta^2_{SY} \var{Y}}{\var{Y}} \\
V_S &amp;= \frac{2\beta^2_{SX} m(1-m) + \beta^2_{SY}\var{Y}}{R^2_S} \\
\end{aligned}
\]</span></p>
<p>So Vx = 2m(1-m), Vy is fixed, and Vs will depend on Vx and the effects.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">12345</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">10000</span>
<span class="no">maf</span> <span class="kw">&lt;-</span> <span class="fl">0.3</span>
<span class="no">rsq_gs</span> <span class="kw">&lt;-</span> <span class="fl">0.1</span>
<span class="no">rsq_xs</span> <span class="kw">&lt;-</span> <span class="fl">0.2</span>
<span class="no">vx</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">vs</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">rsq_s</span> <span class="kw">&lt;-</span> <span class="no">rsq_gs</span> + <span class="no">rsq_xs</span>
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>,<span class="fl">2</span>,<span class="no">maf</span>)
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">b_gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">rsq_gs</span> * <span class="no">vs</span> / (<span class="fl">2</span>*<span class="no">maf</span>*(<span class="fl">1</span>-<span class="no">maf</span>)))
<span class="no">b_xs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">rsq_xs</span> * <span class="no">vs</span> / <span class="no">vx</span>)
<span class="no">ve</span> <span class="kw">&lt;-</span> <span class="no">vs</span> - <span class="no">b_gs</span>^<span class="fl">2</span> * <span class="fl">2</span>*<span class="no">maf</span>*(<span class="fl">1</span>-<span class="no">maf</span>) - <span class="no">b_xs</span>^<span class="fl">2</span> * <span class="no">vx</span>
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">g</span> * <span class="no">b_gs</span> + <span class="no">x</span> * <span class="no">b_xs</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">ve</span>))
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>)
<span class="co">#&gt; [1] 1.003837</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">g</span>, <span class="no">s</span>)^<span class="fl">2</span>
<span class="co">#&gt; [1] 0.1052695</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">x</span>, <span class="no">s</span>)^<span class="fl">2</span>
<span class="co">#&gt; [1] 0.2034182</span></pre></body></html></div>
<p><span class="math display">\[
\beta_{GS} = \sqrt{\frac{R^2_{GS} \var{S}}{2m(1-m)}}
\]</span> and</p>
<p><span class="math display">\[
\beta_{XS} = \sqrt{\frac{R^2_{XS} \var{S}}{\var{X}}}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
e_i \sim N\left(0, \var{S} - \beta_{XS}^2 \var{X} - 2 \beta_{GS}^2 m(1-m) \right)
\]</span></p>
<p>Remove data, just parameters.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># input parameters</span>
<span class="no">n</span> <span class="kw">=</span> <span class="fl">100000</span>
<span class="no">prop</span> <span class="kw">&lt;-</span> <span class="fl">0.3</span>
<span class="no">or_sz</span> <span class="kw">&lt;-</span> <span class="fl">2.5</span>
<span class="no">b_xy</span> <span class="kw">=</span> <span class="fl">0</span>
<span class="no">rsq_xs</span> <span class="kw">=</span> <span class="fl">0.05</span>
<span class="no">rsq_ys</span> <span class="kw">=</span> <span class="fl">0.1</span>
<span class="no">maf</span> <span class="kw">=</span> <span class="fl">0.3</span>
<span class="no">vy</span> <span class="kw">=</span> <span class="fl">1</span>
<span class="no">vs</span> <span class="kw">=</span> <span class="fl">1</span>

<span class="co"># infer</span>
<span class="no">logor_sz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">or_sz</span>)
<span class="no">vz</span> <span class="kw">&lt;-</span> <span class="no">prop</span> * (<span class="fl">1</span>-<span class="no">prop</span>)
<span class="no">vx</span> <span class="kw">&lt;-</span> <span class="fl">2</span> * <span class="no">maf</span> * (<span class="fl">1</span>-<span class="no">maf</span>)
<span class="no">b_xs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">rsq_xs</span> * <span class="no">vs</span> / (<span class="fl">2</span>*<span class="no">maf</span>*(<span class="fl">1</span>-<span class="no">maf</span>)))
<span class="no">b_ys</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">rsq_ys</span> * <span class="no">vs</span> / <span class="no">vy</span>)
<span class="no">ve</span> <span class="kw">&lt;-</span> <span class="no">vs</span> - <span class="no">b_xs</span>^<span class="fl">2</span> * <span class="fl">2</span>*<span class="no">maf</span>*(<span class="fl">1</span>-<span class="no">maf</span>) - <span class="no">b_ys</span>^<span class="fl">2</span> * <span class="no">vy</span>
<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>((<span class="fl">1</span> - <span class="no">prop</span>)/<span class="no">prop</span>)

<span class="co"># generate</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">678910</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">2</span>, <span class="no">maf</span>)
<span class="no">s</span> <span class="kw">&lt;-</span> <span class="no">x</span> * <span class="no">b_xs</span> + <span class="no">y</span> * <span class="no">b_ys</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">ve</span>))
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">s</span>,<span class="no">x</span>)^<span class="fl">2</span>
<span class="co">#&gt; [1] 0.04944724</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">s</span>,<span class="no">y</span>)^<span class="fl">2</span>
<span class="co">#&gt; [1] 0.1004749</span>
<span class="no">l</span> <span class="kw">&lt;-</span> <span class="no">alpha</span> + <span class="no">logor_sz</span> * <span class="no">s</span>
<span class="no">pr</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">l</span>))
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">n</span>, <span class="fl">1</span>, <span class="no">pr</span>)

<span class="co"># infer</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>] ~ <span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>])$<span class="no">coef</span>[<span class="fl">2</span>]
<span class="co">#&gt;  x[z == 1] </span>
<span class="co">#&gt; -0.0118145</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">y</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>], <span class="no">x</span>[<span class="no">z</span><span class="kw">==</span><span class="fl">1</span>])
<span class="co">#&gt; [1] -0.007827659</span>

<span class="co"># derive</span>
<span class="no">bh_xs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">s</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)
<span class="no">bh_xz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)
<span class="no">bh_ys</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">s</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)
<span class="no">bh_yz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)
<span class="no">bh_sz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">s</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">s</span>)

(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="no">bh_xz</span> * <span class="no">bh_yz</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / (<span class="no">bh_yz</span>^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt; [1] -0.01305981</span>
(<span class="no">b_xy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) - <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>)) / ((<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">y</span>,<span class="no">z</span>)/<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>))^<span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">y</span>) + <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>)*<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">z</span>))
<span class="co">#&gt; [1] -0.01305981</span>
(<span class="no">b_xy</span> * <span class="no">vz</span> * <span class="no">vx</span> - <span class="no">b_xs</span> * <span class="no">logor_sz</span> * <span class="no">vz</span> * <span class="no">b_ys</span> * <span class="no">logor_sz</span> * <span class="no">vz</span> * <span class="no">vx</span> * <span class="no">vy</span>) / ((<span class="no">b_ys</span> * <span class="no">logor_sz</span> * <span class="no">vz</span>)^<span class="fl">2</span> * <span class="no">vx</span> * <span class="no">vy</span> + <span class="no">vx</span>*<span class="no">vz</span>)
<span class="co">#&gt; [1] -0.01890409</span></pre></body></html></div>
<p>How to test power. Two different ways, just use the native version</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">param</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(
  <span class="kw">rsq</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">0.001</span>),
  <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>,<span class="fl">1000</span>, <span class="fl">10000</span>)
)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">param</span>))
{
  <span class="no">param</span>$<span class="no">p1</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.anova.test.html">power.anova.test</a></span>(<span class="kw">groups</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">n</span><span class="kw">=</span><span class="no">param</span>$<span class="no">n</span>[<span class="no">i</span>], <span class="kw">between.var</span><span class="kw">=</span><span class="no">param</span>$<span class="no">rsq</span>[<span class="no">i</span>], <span class="kw">within.var</span><span class="kw">=</span><span class="fl">1</span>-<span class="no">param</span>$<span class="no">rsq</span>[<span class="no">i</span>],<span class="kw">sig.level</span><span class="kw">=</span><span class="fl">0.05</span>)$<span class="no">power</span>
  <span class="no">param</span>$<span class="no">p2</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pwr/man/pwr.r.test.html">pwr.r.test</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="no">param</span>$<span class="no">n</span>[<span class="no">i</span>],<span class="kw">r</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">param</span>$<span class="no">rsq</span>[<span class="no">i</span>]),<span class="kw">sig.level</span><span class="kw">=</span><span class="fl">0.05</span>)$<span class="no">power</span>
}
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">param</span>$<span class="no">p1</span>, <span class="no">param</span>$<span class="no">p2</span>)</pre></body></html></div>
<p><img src="collider_ascertainment_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Now create function</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">simulate_y_structure</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">n</span>, <span class="no">prop</span>, <span class="no">or_sz</span>, <span class="no">b_xy</span>, <span class="no">rsq_xs</span>, <span class="no">rsq_ys</span>, <span class="no">maf</span>, <span class="no">vy</span><span class="kw">=</span><span class="fl">1</span>, <span class="no">vs</span><span class="kw">=</span><span class="fl">1</span>, <span class="no">sig.level</span><span class="kw">=</span><span class="fl">5e-8</span>)
{
  <span class="co"># infer</span>
  <span class="no">logor_sz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">or_sz</span>)
  <span class="no">vz</span> <span class="kw">&lt;-</span> <span class="no">prop</span> * (<span class="fl">1</span>-<span class="no">prop</span>)
  <span class="no">vx</span> <span class="kw">&lt;-</span> <span class="fl">2</span> * <span class="no">maf</span> * (<span class="fl">1</span>-<span class="no">maf</span>)
  <span class="no">b_xs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">rsq_xs</span> * <span class="no">vs</span> / (<span class="fl">2</span>*<span class="no">maf</span>*(<span class="fl">1</span>-<span class="no">maf</span>)))
  <span class="no">b_ys</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">rsq_ys</span> * <span class="no">vs</span> / <span class="no">vy</span>)
  <span class="no">ve</span> <span class="kw">&lt;-</span> <span class="no">vs</span> - <span class="no">b_xs</span>^<span class="fl">2</span> * <span class="fl">2</span>*<span class="no">maf</span>*(<span class="fl">1</span>-<span class="no">maf</span>) - <span class="no">b_ys</span>^<span class="fl">2</span> * <span class="no">vy</span>
  <span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>((<span class="fl">1</span> - <span class="no">prop</span>)/<span class="no">prop</span>)
  <span class="no">bh_xy</span> <span class="kw">&lt;-</span> (<span class="no">b_xy</span> * <span class="no">vz</span> * <span class="no">vx</span> - <span class="no">b_xs</span> * <span class="no">logor_sz</span> * <span class="no">vz</span> * <span class="no">b_ys</span> * <span class="no">logor_sz</span> * <span class="no">vz</span> * <span class="no">vx</span> * <span class="no">vy</span>) / ((<span class="no">b_ys</span> * <span class="no">logor_sz</span> * <span class="no">vz</span>)^<span class="fl">2</span> * <span class="no">vx</span> * <span class="no">vy</span> + <span class="no">vx</span>*<span class="no">vz</span>)
  <span class="no">cor_xy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">bh_xy</span>^<span class="fl">2</span> * <span class="no">vx</span> / <span class="no">vy</span>) * <span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span>(<span class="no">bh_xy</span>)
  <span class="no">pow</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.anova.test.html">power.anova.test</a></span>(<span class="kw">groups</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">n</span><span class="kw">=</span><span class="no">n</span> * <span class="no">prop</span>, <span class="kw">between.var</span><span class="kw">=</span><span class="no">cor_xy</span>^<span class="fl">2</span>, <span class="kw">within.var</span> <span class="kw">=</span> <span class="fl">1</span> - <span class="no">cor_xy</span>^<span class="fl">2</span>, <span class="kw">sig.level</span><span class="kw">=</span><span class="no">sig.level</span>)$<span class="no">power</span>
  <span class="no">ns</span> <span class="kw">&lt;-</span> <span class="no">n</span> * <span class="no">prop</span>
  <span class="no">se</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>((<span class="fl">1</span> - <span class="no">cor_xy</span>^<span class="fl">2</span>) * <span class="no">vs</span> / (<span class="no">ns</span> * <span class="no">vx</span>))
  <span class="no">pval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">bh_xy</span> / <span class="no">se</span>), <span class="kw">lower.tail</span><span class="kw">=</span><span class="fl">FALSE</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">bh_xy</span><span class="kw">=</span><span class="no">bh_xy</span>, <span class="kw">cor_xy</span><span class="kw">=</span><span class="no">cor_xy</span>, <span class="kw">pow</span><span class="kw">=</span><span class="no">pow</span>, <span class="kw">se</span><span class="kw">=</span><span class="no">se</span>, <span class="kw">pval</span><span class="kw">=</span><span class="no">pval</span>, <span class="kw">ns</span><span class="kw">=</span><span class="no">ns</span>))
}
<span class="fu"><a href="../reference/simulate_y_structure.html">simulate_y_structure</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="fl">50000000</span>, <span class="kw">prop</span><span class="kw">=</span><span class="fl">0.8</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>)
<span class="co">#&gt; $bh_xy</span>
<span class="co">#&gt; [1] -0.001078848</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $cor_xy</span>
<span class="co">#&gt; [1] -0.0007628605</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pow</span>
<span class="co">#&gt; [1] 0.2654754</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $se</span>
<span class="co">#&gt; [1] 0.0002236067</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pval</span>
<span class="co">#&gt; [1] 7.008774e-07</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ns</span>
<span class="co">#&gt; [1] 4e+07</span>
<span class="fu"><a href="../reference/simulate_y_structure.html">simulate_y_structure</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="fl">50000000</span>, <span class="kw">prop</span><span class="kw">=</span><span class="fl">0.2</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>)
<span class="co">#&gt; $bh_xy</span>
<span class="co">#&gt; [1] -0.001078848</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $cor_xy</span>
<span class="co">#&gt; [1] -0.0007628605</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pow</span>
<span class="co">#&gt; [1] 0.001187094</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $se</span>
<span class="co">#&gt; [1] 0.0004472135</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pval</span>
<span class="co">#&gt; [1] 0.007924431</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ns</span>
<span class="co">#&gt; [1] 1e+07</span></pre></body></html></div>
<p>Run some simulations</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">param</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(
  <span class="kw">n</span> <span class="kw">=</span> <span class="fl">50000000</span>,
  <span class="kw">prop</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="kw">by</span><span class="kw">=</span><span class="fl">0.01</span>),
  <span class="kw">or_sz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>, <span class="fl">1.75</span>, <span class="fl">2</span>, <span class="fl">3</span>),
  <span class="kw">b_xy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>),
  <span class="kw">rsq_xs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.0001</span>,<span class="fl">0.0005</span>, <span class="fl">0.001</span>),
  <span class="kw">rsq_ys</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>),
  <span class="kw">maf</span> <span class="kw">=</span> <span class="fl">0.3</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">param</span>)
<span class="co">#&gt; [1] 5346    7</span>

<span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">param</span>), <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="no">P</span> <span class="kw">&lt;-</span> <span class="no">param</span>[<span class="no">x</span>,]
  <span class="no">o</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simulate_y_structure.html">simulate_y_structure</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="no">P</span>$<span class="no">n</span>, <span class="kw">prop</span><span class="kw">=</span><span class="no">P</span>$<span class="no">prop</span>, <span class="no">P</span>$<span class="no">or_sz</span>, <span class="no">P</span>$<span class="no">b_xy</span>, <span class="no">P</span>$<span class="no">rsq_xs</span>, <span class="no">P</span>$<span class="no">rsq_ys</span>, <span class="no">P</span>$<span class="no">maf</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">P</span>, <span class="no">o</span>))
}) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/bind.html">bind_rows</a></span>()

<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">res</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">prop</span>*<span class="no">n</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">cor_xy</span>, <span class="kw">group</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid</a></span>(<span class="no">rsq_xs</span> ~ <span class="no">rsq_ys</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_brewer.html">scale_colour_brewer</a></span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span>(<span class="kw">axis.text.x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span>(<span class="kw">angle</span><span class="kw">=</span><span class="fl">90</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">vjust</span><span class="kw">=</span><span class="fl">0.5</span>))</pre></body></html></div>
<p><img src="collider_ascertainment_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">res</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">prop</span>*<span class="no">n</span>, <span class="kw">y</span><span class="kw">=</span>-<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">pval</span>), <span class="kw">group</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid</a></span>(<span class="no">rsq_xs</span> ~ <span class="no">rsq_ys</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_brewer.html">scale_colour_brewer</a></span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span>(<span class="kw">axis.text.x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span>(<span class="kw">angle</span><span class="kw">=</span><span class="fl">90</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">vjust</span><span class="kw">=</span><span class="fl">0.5</span>))</pre></body></html></div>
<p><img src="collider_ascertainment_files/figure-html/unnamed-chunk-19-2.png" width="700"></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span>(<span class="no">res</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">prop</span>*<span class="no">n</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">pow</span>, <span class="kw">group</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span>(<span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">or_sz</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid</a></span>(<span class="no">rsq_xs</span> ~ <span class="no">rsq_ys</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_abline.html">geom_vline</a></span>(<span class="kw">xintercept</span><span class="kw">=</span><span class="fl">5000000</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_brewer.html">scale_colour_brewer</a></span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span>(<span class="kw">axis.text.x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span>(<span class="kw">angle</span><span class="kw">=</span><span class="fl">90</span>, <span class="kw">hjust</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">vjust</span><span class="kw">=</span><span class="fl">0.5</span>))</pre></body></html></div>
<p><img src="collider_ascertainment_files/figure-html/unnamed-chunk-19-3.png" width="700"></p>
</div>
<div id="converting-odds-ratios-to-betas-based-on-case-proportion" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-odds-ratios-to-betas-based-on-case-proportion" class="anchor"></a>Converting odds ratios to betas based on case proportion</h2>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># simulate SNP</span>
<span class="no">x1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fl">10000</span>, <span class="fl">2</span>, <span class="fl">0.4</span>)

<span class="co"># liability</span>
<span class="no">z</span> <span class="kw">=</span> <span class="fl">1</span> + <span class="fl">0.2</span>*<span class="no">x1</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">z</span>)
<span class="co">#&gt; [1] 1.15976</span>

<span class="co"># probability of case</span>
<span class="no">pr</span> <span class="kw">=</span> <span class="fl">1</span>/(<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">z</span>))

<span class="co"># sample cases</span>
<span class="no">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fl">10000</span>,<span class="fl">1</span>,<span class="no">pr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">y</span>)
<span class="co">#&gt; y</span>
<span class="co">#&gt;    0    1 </span>
<span class="co">#&gt; 2388 7612</span>

<span class="co">#now feed it to glm:</span>
(<span class="no">logor</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">y</span> ~ <span class="no">x1</span>, <span class="kw">family</span><span class="kw">=</span><span class="st">"binomial"</span>)$<span class="no">coef</span>[<span class="fl">2</span>])
<span class="co">#&gt;        x1 </span>
<span class="co">#&gt; 0.2132723</span>

<span class="co"># estimate lm</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(<span class="no">x1</span>,<span class="no">y</span>) / <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x1</span>)
<span class="co">#&gt; [1] 0.03819507</span>
(<span class="no">beta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">y</span> ~ <span class="no">x1</span>)$<span class="no">coef</span>[<span class="fl">2</span>])
<span class="co">#&gt;         x1 </span>
<span class="co">#&gt; 0.03819507</span>

<span class="co"># convert beta to logor</span>
<span class="no">prop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">y</span> <span class="kw">==</span> <span class="fl">1</span>) / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">y</span>)
<span class="no">mu</span> <span class="kw">&lt;-</span> <span class="no">prop</span> * (<span class="fl">1</span> - <span class="no">prop</span>)
<span class="no">beta</span> / <span class="no">mu</span>
<span class="co">#&gt;        x1 </span>
<span class="co">#&gt; 0.2101233</span>

<span class="co"># Is it different when you use the known intercept?</span>
<span class="no">propt</span> <span class="kw">&lt;-</span> (<span class="fl">1</span> / (<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="fl">1</span>)))
<span class="no">mut</span> <span class="kw">&lt;-</span> <span class="no">propt</span> * (<span class="fl">1</span> - <span class="no">propt</span>)
<span class="no">beta</span> / <span class="no">mut</span>
<span class="co">#&gt;        x1 </span>
<span class="co">#&gt; 0.1942663</span></pre></body></html></div>
<hr>
<p><span class="math display">\[
\cov(s,z) = p(1-p) \left(\E{s | z = 1} - \E{s | z = 0}\right)
\]</span></p>
<p>Here <span class="math inline">\(p\)</span> is the proportion of individuals in the popoulation recruited into the sample. For simplicity call <span class="math inline">\(\delta = \E{s | z = 1} - \E{s | z = 0}\)</span> the difference in mean educational attainment values between individuals recruited and not recruited into the study.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gibran Hemani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
